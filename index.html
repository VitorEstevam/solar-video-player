<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Custom Viewer</title>
</head>

<body>
    <div id="inputs">
        <input type="text" placeholder="class link" id="classInput">
        <input type="button" value="open class" onclick="openClass();" />
    </div>

    <video id="video" controls></video>
    <video id="sound"></video>
</body>

<script>
    var video = document.querySelector("#video")
    var sound = document.querySelector("#sound")

    function openClass() {
        let value = document.querySelector("#classInput").value
        const arr = value.split("/")
        id = arr[arr.length - 1]

        videoUrl = "https://web.virtual.ufc.br/presentation/" + id + "/deskshare/deskshare.mp4"
        video.setAttribute('src', videoUrl);
        soundUrl = "https://web.virtual.ufc.br/presentation/" + id + "/video/webcams.mp4"
        sound.setAttribute('src', soundUrl)
    }

    playing = false
    state = "visible"
    // keep playing when change tabs
    document.addEventListener("visibilitychange", function () {
        setTimeout(() => {
            state = document.visibilityState
            console.log("state: " + document.visibilityState)
        }, 2);
    });

    // play
    video.addEventListener("play", function (ev) {
        ev.preventDefault()

        if (state == "visible") {
            console.log("play")
            playing = true
            sound.play()
            sound.currentTime = video.currentTime
            sound.playbackRate = video.playbackRate
        }

    }, false);

    // pause
    video.addEventListener("pause", function (ev) {
        ev.preventDefault()
        setTimeout(() => {
            if (state == "visible") {
                console.log("pause")
                playing = false
                sound.pause()
                video.pause()
            }
        }, 1);
    }, false);

    // ratechange
    video.addEventListener("ratechange", function () {
        console.log("rate change")
        sound.playbackRate = video.playbackRate
    }, false);
</script>

<style>
    body {
        padding-left: 10%;
        padding-right: 10%;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    #sound {
        display: none;
    }

    #video {
        flex: 1;
        width: 100%;
        border-style: inset;
    }

    #inputs {
        width: 50%;
        display: flex;
        flex-direction: row;
        padding: 20px;
        padding-left: 0px;
    }

    #classInput {
        flex: 1
    }
</style>

</html>